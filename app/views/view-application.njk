{% extends './layouts/layout.njk' %}

{% block pageTitle %}
  {{ siteTitle }}: User Application
{% endblock %}

{% block beforeContent %}
  {{ govukBackLink({
        text: "Back",
        href: "/applications"
      }) }}
{% endblock %}
{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-caption-l govuk-!-margin-bottom-3">Application {{ applicationId }}</h1>

      <h2 class="govuk-fieldset__legend--m">{{ organisationName }}
        <span class="govuk-tag {{ statusClass }}">{{ status }}</span></h2>
      {{ govukSummaryList({
        rows: listData.rows
      }) }}
      {% if autoPayment === false %}
        {% if fraudCheckPassed === false %}
          <form method="POST" autocomplete="off" novalidate="novalidate" action="/application/fraud-check/{{ applicationId }}">
            <input type="hidden" name="crumb" value="{{crumb}}"/>
            {{ govukRadios(radios) }}
            {{ govukButton({
            text: "Submit",
            attributes: {id: "btnSubmit"}
          }) }}
          </form>
        {% elif fraudCheckPassed === 'yes'%}
          <h2 class="govuk-fieldset__legend--m">Fraud Check <span class="govuk-tag govuk-tag--purple">Accepted</span></h2>
        {% elif fraudCheckPassed === 'no'%}
          <h2 class="govuk-fieldset__legend--m">Fraud Check <span class="govuk-tag govuk-tag--red">Rejected</span></h2>
        {% endif %}

        {% if (fraudCheckPassed === 'yes') and (paymentPaid === false) %}
          <form method="POST" autocomplete="off" novalidate="novalidate" action="/application/payment/{{ applicationId }}">
            <input type="hidden" name="crumb" value="{{crumb}}"/>
            {{ govukRadios(paymentRadio) }}
            {{ govukButton({
            text: "Submit",
            attributes: {id: "btnSubmit"}
          }) }}
          </form>
        {% elif(paymentPaid === 'yes')or(paymentPaid === 'no') %}
          <h2 class="govuk-fieldset__legend--m">Payment <span class="govuk-tag {{ statusClass }}">{{ status }}</span></h2>
        {% endif %}
      {% endif %}

      {% set applicationHtml %}
      <h2 class="govuk-heading-l">{{ status }}</h2>
      {{ govukTable(applicationData) }}
      {% endset -%}

      {% set vetReviewHtml %}
      {% if vetVisit %}
        <h2 class="govuk-heading-l">Data inputted</h2>
        {{ govukTable(vetVisitData) }}
      {% else %}
        <h2 class="govuk-heading-l">Not yet reviewed</h2>
      {% endif %}
      {% endset -%}

      {% set claimHtml %}
      {% if claimed %}
        <h2 class="govuk-heading-l">Selected for fraud check</h2>
        {{ govukTable(claimData) }}
      {% else %}
        <h2 class="govuk-heading-l">Not yet able to claim</h2>
      {% endif %}
      {% endset -%}

      {% set paymentHtml %}
      {% if payment %}
        <h2 class="govuk-heading-l">Payment information</h2>
        {{ govukTable(paymentData) }}
      {% else %}
        <h2 class="govuk-heading-l">Not yet paid</h2>
      {% endif %}
      {% endset -%}

      {{ govukTabs({
        items: [
          {
            label: "Application",
            id: "application",
            panel: {
              html: applicationHtml
            }
          },
          {
            label: "Vet Review",
            id: "vet-review",
            panel: {
              html: vetReviewHtml
            }
          },
          {
            label: "Claim",
            id: "claim",
            panel: {
              html: claimHtml
            }
          },
          {
            label: "Payment",
            id: "payment",
            panel: {
              html: paymentHtml
            }
          }
        ]
      }) }}
    </div>
  </div>
{% endblock %}