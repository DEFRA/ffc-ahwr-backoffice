{% extends './layouts/layout.njk' %}
{% from "./macros/applications-table.njk" import applicationsTable %}

{% block pageTitle %}
  {{ siteTitle }}: AHWR Applications
{% endblock %}

{% block beforeContent %}
  {{ govukBackLink({
        text: "Back",
        href: "/"
      }) }}
{% endblock %}

{% block content %}

  <form method="POST" action="/applications" id="submitForm">
    <div class="govuk-grid-row govuk-!-padding-bottom-9">
      <h1 class="govuk-heading-l">Annual health and welfare review agreements</h1>
      <div class="user-search-box govuk-!-width-two-thirds">
        <label class="govuk-label govuk-label--s" for="searchText">
          Search by agreement number, organisation or single business identifier (SBI) number
        </label>
        <input type="hidden" name="crumb" value="{{crumb}}"/>
        <input class="govuk-input" id="searchText" name="searchText" type="text" value="{{model.searchText}}" spellcheck="false">
        <button class="search-button" data-module="govuk-button" name="submit" value="search">
                Search
        </button>
      </div>
    </div>

    {% if model.error or error %}
      <div class="govuk-grid-row">
        <p class="govuk-error-message">{{model.error}}{{error}}</p>
      </div>
    {% else %}
      <div class="govuk-grid-row">
        <div class="moj-filter-layout">

          <div class="moj-filter-layout__filter">
            {%- set filterOptionsHtml %}
            {{ govukCheckboxes({
                      idPrefix: 'status',
                      name: 'status',
                      classes: "govuk-checkboxes--small",
                      fieldset: {
                        legend: {
                          text: 'Status',
                          classes: 'govuk-fieldset__legend--m'
                        }
                      },
                      items: model.filterStatus
                      }) }}

            {% endset -%}

            {{ mojFilter({
                    heading: {
                      text: 'Filter'
                    },
                    selectedFilters: {
                      heading: {
                        text: 'Selected filters'
                      },
                      clearLink: {
                        text: 'Clear filters',
                        href: '/applications/clear'
                      },
                      categories: [
                        {
                          heading: {
                            text: 'Status'
                          },
                          items: model.selectedStatus
                        }
                      ]
                    },
                    optionsHtml: filterOptionsHtml
                  }) }}
          </div>

          <div class="moj-filter-layout__content">
            {# <div class="moj-action-bar">
              <div class="moj-action-bar__filter hide_pseudo_after"></div>
            </div> #}
            <div class="moj-scrollable-pane">

              <div class="moj-scrollable-pane__wrapper">
                {{ govukTable({
            attributes: {
              'data-module': 'moj-sortable-table'
            },
            firstCellIsHeader: false,
            head: model.header,
            rows: model.applications
          }) }}
                {{ govukPagination({
            previous: model.previous,
            next: model.next,
            items: model.pages
          }) 
          }}
              </div>

            </div>
          </div>
        {% endif %}
      </form>
    {% endblock %}